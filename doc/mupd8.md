#MUPD8

人们通常想知道类似的系统比较。我们已经尽力对比Samza与其他相似系统的特性。但我们在这些框架方面不是专家,我们当然完全有偏见。如果我们有错误,请让我们知道,我们会改正它。

##Durability

MUPD8没有持久性或发送保证。在MUPD8,流处理器任务接收消息最多一次。Samza使用Kafka的消息传递,保证消息传递。

##Ordering

与持久性一样,开发人员会按他们的流处理器接收消息的顺序写消息,。

我们并不完全了解MUPD8的描述他们的顺序保证,但它似乎保证将处理所有消息的顺序写MUPD8队列,这是与Samza写入Kafka作为保证是一致的。

##Buffering

处理大型数据流处理的一个关键问题处理后备压力当一个下游处理变得缓慢。

MUPD8把信息缓存在内存队列中，当两个MUPD8任务进行传递消息时。当队列被填满时,开发人员可以选择要么删除消息,要么把消息记录到本地磁盘,或阻塞直到队列释放。所有这些选项都是次优的。删除消息导致不正确的结果。阻止你的流处理器可能导致级联效应,最慢的处理器模块阻塞上游处理器,进而阻止他们的上游处理器,直到整个系统崩溃。日志记录到本地磁盘是最合理的,但当一个错误发生进行故障转移时,这些消息丢失。

通过采用Kafka Broker作为远程缓冲区,Samza解决所有上述问题。它不需要阻塞,因为消费者和生产者使用Kafka是解耦的borker的磁盘缓冲区。消息不丢失是因为Kafka broker高度可用的0.8版。在发生故障时,Samza工作重新启动另一台机器上时,它的输入和输出不会丢失,因为他们存储远程复制kafka broker。

##State Management

如上所述,流处理器通常需要保持一些状态处理消息。不同的框架有不同的方法来处理这类状态,并在失败的情况下该做什么。

MUPD8使用回写缓存策略来管理内存状态,定期写回到Cassandra。

Samza本地维护任务状态。这允许大于内存状态。状态保存到输出流,使恢复应该任务失败。我们认为这种设计使强大的容错语义,因为更改日志捕捉的进化状态,允许任务的状态恢复到一个一致的时间点。

##Deployment and execution

MUPD8包括一个定制的执行框架。此框架是否支持按用户和资源限制的功能我们还不清楚。

Samza利用YARN部署用户代码,在分布式环境中执行它。

##Fault Tolerance

当机器或处理器失败流处理系统应该做些什么呢?

MUPD8利用其自定义管理容错相当于YARN。当一个流处理器无法发送消息给下游处理器,它通知MUPD8协调员,并通知所有其他机器。然后机器所有消息发送到一个新机器根据使用的散列的关键字。消息和状态可能会丢失当这一切发生的时候。

Samza使用YARN来管理容错。YARN检测当节点或Samza任务失败,并通知Samza ApplicationMaster。在这一点上,它是由Samza决定该做什么。一般来说,这意味着重新启动另一台机器上的任务。因为消息被保存到远程Kakfka Broker,没有内存中的队列,消息不应丢失(除非处理器使用的是异步Kafka Producer,提供更高的性能,但不要等到消息提交)。

##Workflow

有时不止一项工作或处理阶段需要完成的东西。这是你希望re-partition流的情况,例如。MUPD8定制工作流系统设置来定义如何执行多个作业,以及如何填流数据从一端到另端。

Samza使单个作业的粒度级别执行。作业通过指定输入和输出流通信。这种隐式定义一个数据流图之间的所有正在运行的工作。我们选择这个模型,使数据流图表处理阶段由不同的工程师在不同的团队,工作在不同的代码库,而不需要把一切组合进一个拓扑中。

这是出于我们的经验使用Hadoop,作业之间的数据流是隐式定义为输入和输出目录。这种分散的模式已被大规模使用。

##Memory

MUPD8使用线程执行它的所有Map/Update处理在一个JVM。这是节省内存,因为JVM内存开销是跨线程共享。

Samza为每个流处理器容器使用一个单独的JVM。这有使用更多内存的缺点,运行多个流处理线程在一个JVM。然而,优点是改善隔离任务,这可以使他们更可靠。

##Isolation

MUPD8没有提供流处理器资源之间的隔离。一个表现不好的流处理器可以降低节点上的所有处理器。

Samza使用进程级别隔离流处理器的任务,类似于Hadoop的方法。我们可以执行严格的每个进程的内存限制。此外,Samza支持并且使用YARN时CPU限制。YARN的支持并且进一步发展,它还应该成为可能支持磁盘和网络cgroup的限制。

##Further Reading

MUPD8团队发布了一篇很好的[论文](http://vldb.org/pvldb/vol5/p1814_wanglam_vldb2012.pdf)的设计系统。